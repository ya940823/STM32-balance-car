/*********************************************************************************
 * ???  : ????????
 * ??    : STM32 ??????
*********************************************************************************/
#include "stm32f10x.h"        // STM32 ??????
#include "mpu6050.h"          // MPU6050 ?????
#include "i2c_mpu6050.h"      // ?? I2C ??? MPU6050 ??????
#include "motor.h"            // ??????
#include "Balancecar.h"       // ??????????
#include "SysTick.h"          // ??????(SysTick)??????
#include "Serial.h"           // ??????,????????
#include "timer.h"            // ??????
#include "UltraSonic.h"       // ???????
#include <string.h>
#include <stdio.h>

/**************************************************************
 * ???:main
 * ??  :???,?????????
 **************************************************************/
int main(void)
{	
  SystemInit();                             // ???????
	Timerx_Init(5000, 7199);                 // ??? TIM1,???????
	UltraSonic_Init();                       // ????????		    
	Serial_Init();				                 // ?????(?????????)
	bluetooth_Init();		                   // ???????
	
	TIM2_PWM_Init();		                   // ??? TIM2,?? PWM ??
	MOTOR_Init();		                       // ?????????
	
  TIM3_Encoder_Init();                      // ??????,??????(?? PA6, PA7)
  TIM4_Encoder_Init();                      // ??????,??????(?? PB6, PB7)
	
	MPU6050_Init();			                     // ??? MPU6050 ?????
	SysTick_Init();			                     // ?????????
	BalancingCarParameterInit();             // ?????????????
	
	SysTick->CTRL |= SysTick_CTRL_ENABLE_Msk;  // ????????

	while (1)
	{
		MPU6050_Pose();                       // ?? MPU6050 ????????(????)
		
		if(MyUsart3.flag)	                   // ?????????????
		{
			MyUsart3.flag = 0;                // ????????
			Packetparsing();                  // ??????????
		}
		
		Balancingcarcontrol();                // ???????????(PID ????)
	}
}
